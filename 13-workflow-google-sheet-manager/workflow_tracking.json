{
  "name": "Google Sheets Version Tracking (end)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "id": "9795e2e1-c606-4efa-a24e-0ab065072d72",
      "name": "Every 5 Minutes1",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -768,
        288
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID",
          "mode": "list",
          "cachedResultName": "Your Sheet Name",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/YOUR_GOOGLE_SHEET_ID/edit"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Your Sheet Tab Name",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/YOUR_GOOGLE_SHEET_ID/edit#gid=0"
        },
        "options": {}
      },
      "id": "99f78d19-96b1-4ed5-bf06-3bad9914bad9",
      "name": "Read Current Sheet1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -576,
        288
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Your Credential"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// í˜„ì¬ ì‹œíŠ¸ ë°ì´í„° ì¤€ë¹„\nconst sheetId = 'YOUR_GOOGLE_SHEET_ID';\nconst sheetName = 'YOUR_SHEET_NAME';\nconst currentData = $input.all().map(item => item.json);\n\n// ê°„ë‹¨í•œ í•´ì‹œ ìƒì„±\nfunction simpleHash(data) {\n  const str = JSON.stringify(data);\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  return hash.toString(16);\n}\n\nreturn [{\n  json: {\n    sheet_id: sheetId,\n    sheet_name: sheetName,\n    current_data: currentData,\n    row_count: currentData.length,\n    data_hash: simpleHash(currentData),\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "c8f099f5-3c81-47fc-8acf-e3164f8a7f4a",
      "name": "Prepare Data1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        288
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "sheet_versions",
        "limit": 1
      },
      "id": "4b820dc1-4200-4703-86c5-3c1c38de76b7",
      "name": "Get Last Version1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        48,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": false,
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n  JSON.stringify({\n    model: \"gpt-4o-mini\",\n    temperature: 0.3,\n    max_tokens: 500,\n    messages: [\n      {\n        role: \"system\",\n        content: \"ë‹¹ì‹ ì€ ë°ì´í„° ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. í•­ìƒ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•©ë‹ˆë‹¤.\"\n      },\n      {\n        role: \"user\",\n        content: \"ë‹¹ì‹ ì€ Google Sheets ë²„ì „ ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\\n\\ní˜„ì¬ ì‹œíŠ¸ ì •ë³´:\\n- í–‰ ê°œìˆ˜: \" + $('Prepare Data1').item.json.row_count + \"ê°œ\\n- ë°ì´í„° í•´ì‹œ: \" + $('Prepare Data1').item.json.data_hash + \"\\n\\n\" + \n        ($('Get Last Version1').all().length > 0 \n          ? \"ì´ì „ ë²„ì „ ì •ë³´:\\n- ë²„ì „ ë²ˆí˜¸: \" + $('Get Last Version1').item.json.version_number + \"\\n- í–‰ ê°œìˆ˜: \" + $('Get Last Version1').item.json.row_count + \"ê°œ\\n- ë°ì´í„° í•´ì‹œ: \" + $('Get Last Version1').item.json.data_hash \n          : \"ì´ì „ ë²„ì „: ì—†ìŒ (ì²« ë²„ì „)\") + \n        \"\\n\\nì‘ì—…:\\n1. í˜„ì¬ ë°ì´í„°ì™€ ì´ì „ ë²„ì „ì„ ë¹„êµ\\n2. ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸\\n3. ë³€ê²½ì‚¬í•­ì„ í•œê¸€ë¡œ ê°„ë‹¨íˆ ìš”ì•½\\n4. ì¤‘ìš”í•œ ë³€ê²½ì¸ì§€ íŒë‹¨\\n\\nì‘ë‹µ í˜•ì‹:\\n{\\n  \\\"has_changes\\\": true,\\n  \\\"summary\\\": \\\"ì„¤ëª…\\\",\\n  \\\"is_important\\\": false,\\n  \\\"next_version\\\": 1\\n}\\n\\n\" + \n        ($('Get Last Version1').all().length === 0 \n          ? \"ì´ì „ ë²„ì „ì´ ì—†ìœ¼ë¯€ë¡œ has_changesëŠ” true, summaryëŠ” 'ì²« ë²„ì „ ìƒì„±', next_versionì€ 1ë¡œ ì„¤ì •í•˜ì„¸ìš”.\" \n          : \"\") + \n        \"\\n\\nì¤‘ìš”: ë°˜ë“œì‹œ ìœ„ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.\"\n      }\n    ]\n  })\n}}",
        "options": {}
      },
      "id": "062960a9-49a0-49a6-b581-5f99387dff43",
      "name": "OpenAI HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        288,
        288
      ],
      "credentials": {
        "openAiApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// OpenAI API ì‘ë‹µ íŒŒì‹±\nconst response = $input.first().json;\nconst aiMessage = response.choices[0].message.content;\n\n// JSON ì¶”ì¶œ (ë§ˆí¬ë‹¤ìš´ ì œê±°)\nlet jsonStr = aiMessage.trim();\n\n// ì½”ë“œë¸”ë¡ ì œê±°\nif (jsonStr.includes('```json')) {\n  jsonStr = jsonStr.split('```json')[1].split('```')[0].trim();\n} else if (jsonStr.includes('```')) {\n  jsonStr = jsonStr.split('```')[1].split('```')[0].trim();\n}\n\ntry {\n  const result = JSON.parse(jsonStr);\n  const preparedData = $('Prepare Data1').first().json;\n  \n  return [{\n    json: {\n      ...preparedData,\n      has_changes: result.has_changes,\n      summary: result.summary,\n      is_important: result.is_important,\n      version_number: result.next_version\n    }\n  }];\n} catch (error) {\n  // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ í´ë°±\n  console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', error);\n  console.log('ì›ë³¸ ì‘ë‹µ:', aiMessage);\n  \n  const preparedData = $('Prepare Data1').first().json;\n  const lastVersion = $('Get Last Version1').all();\n  \n  return [{\n    json: {\n      ...preparedData,\n      has_changes: lastVersion.length === 0 || preparedData.data_hash !== lastVersion[0].json.data_hash,\n      summary: lastVersion.length === 0 ? 'ì²« ë²„ì „ ìƒì„±' : 'ë°ì´í„° ë³€ê²½ ê°ì§€',\n      is_important: false,\n      version_number: lastVersion.length === 0 ? 1 : lastVersion[0].json.version_number + 1\n    }\n  }];\n}"
      },
      "id": "346052e4-321f-409b-866a-b64c0253bba6",
      "name": "Parse AI Response1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        528,
        288
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.has_changes }}",
              "value2": true
            }
          ]
        },
        "options": {}
      },
      "id": "7286933e-0c72-4dde-aee0-4362d26bb29b",
      "name": "IF Changes Detected1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        752,
        288
      ]
    },
    {
      "parameters": {
        "tableId": "sheet_versions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sheet_id",
              "fieldValue": "={{ $json.sheet_id }}"
            },
            {
              "fieldId": "sheet_name",
              "fieldValue": "={{ $json.sheet_name }}"
            },
            {
              "fieldId": "version_number",
              "fieldValue": "={{ $json.version_number }}"
            },
            {
              "fieldId": "data",
              "fieldValue": "={{ JSON.stringify($json.current_data) }}"
            },
            {
              "fieldId": "row_count",
              "fieldValue": "={{ $json.row_count }}"
            },
            {
              "fieldId": "data_hash",
              "fieldValue": "={{ $json.data_hash }}"
            },
            {
              "fieldId": "summary",
              "fieldValue": "={{ $json.summary }}"
            }
          ]
        }
      },
      "id": "61103818-e056-4537-9dd0-107f93ba5c43",
      "name": "Save Version1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1120,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "tableId": "change_history",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sheet_id",
              "fieldValue": "={{ $json.sheet_id }}"
            },
            {
              "fieldId": "sheet_name",
              "fieldValue": "={{ $json.sheet_name }}"
            },
            {
              "fieldId": "version_number",
              "fieldValue": "={{ $json.version_number }}"
            },
            {
              "fieldId": "summary",
              "fieldValue": "={{ $json.summary }}"
            },
            {
              "fieldId": "is_important",
              "fieldValue": "={{ $('IF Changes Detected1').item.json.is_important }}"
            }
          ]
        }
      },
      "id": "b7a88913-562c-4dfb-b29e-601281117c71",
      "name": "Save Change History1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1344,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.is_important }}",
              "value2": true
            }
          ]
        },
        "options": {}
      },
      "id": "f21d3317-2467-4804-b207-31ce26beb43f",
      "name": "IF Important Change1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1552,
        288
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "YOUR_SLACK_CHANNEL_ID",
          "mode": "list",
          "cachedResultName": "your-channel"
        },
        "text": "=ğŸ”” *Google Sheets ì¤‘ìš” ë³€ê²½ ê°ì§€!*\n\n*ì‹œíŠ¸:* {{ $json.sheet_name }}\n*ë²„ì „:* v{{ $json.version_number }}\n*í–‰ ê°œìˆ˜:* {{ $json.row_count }}ê°œ\n*ë³€ê²½ ì‹œê°:* {{ $json.timestamp }}\n\n*ë³€ê²½ ë‚´ì—­:*\n{{ $json.summary }}\n\nğŸ”— ì‹œíŠ¸ ì—´ê¸°: https://docs.google.com/spreadsheets/d/{{ $json.sheet_id }}",
        "otherOptions": {}
      },
      "id": "ada0b19f-0bdd-4da9-b626-405a3d3c3f78",
      "name": "Send Slack Notification1",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        1792,
        288
      ],
      "webhookId": "0db04cdb-b600-4bc3-8d98-7e6ef4da7737",
      "credentials": {
        "slackApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "Slack OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "### 5ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰\n",
        "height": 256,
        "width": 176
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -800,
        176
      ],
      "typeVersion": 1,
      "id": "13c4fc90-3a9a-4f26-8a70-b30c7be675f9",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "### ì‹œíŠ¸ì—ì„œ ëª¨ë“  ë°ì´í„° ì½ê¸°\n",
        "height": 256,
        "width": 208
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -624,
        176
      ],
      "typeVersion": 1,
      "id": "4abb9306-61b4-42b1-8b45-ed797f9ebdf0",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "### ë°ì´í„° ì •ë¦¬ + í•´ì‹œ ìƒì„±\n",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -272,
        176
      ],
      "typeVersion": 1,
      "id": "e1bf7665-5c08-463d-b259-6bc412a5aeb7",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "###  AIì—ê²Œ ë³€ê²½ì‚¬í•­ ë¶„ì„ ìš”ì²­\nì…ë ¥: í˜„ì¬ ë°ì´í„° + ì´ì „ ë²„ì „",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        224,
        176
      ],
      "typeVersion": 1,
      "id": "7d73836c-ceaa-4ee4-9470-6eaafea3b5a1",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "###  AI ì‘ë‹µì—ì„œ JSON ì¶”ì¶œ\nì…ë ¥: AI í…ìŠ¤íŠ¸ ì‘ë‹µ\nì¶œë ¥: êµ¬ì¡°í™”ëœ JSON\ní´ë°±: JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìë™ ê³„ì‚°",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        464,
        176
      ],
      "typeVersion": 1,
      "id": "42724852-31a5-454b-9505-88268aab9517",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "### ë³€ê²½ ìˆëŠ”ì§€ ì²´í¬\nì¡°ê±´: has_changes\nTRUE â†’ ì €ì¥ ì§„í–‰\nFALSE â†’ ì¢…ë£Œ",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        704,
        176
      ],
      "typeVersion": 1,
      "id": "89279893-4662-4c36-9ccb-d25becc20e54",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "content": "### ì—­í• : ìƒˆ ë²„ì „ ì €ì¥\ní…Œì´ë¸”: sheet_versions\nì €ì¥: ì „ì²´ ë°ì´í„° + ë©”íƒ€ì •ë³´\n",
        "height": 256,
        "width": 208
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1072,
        192
      ],
      "typeVersion": 1,
      "id": "5aa46396-a2ce-456b-b100-1973be00bac0",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "### ì—­í• : ë³€ê²½ ë¡œê·¸ ê¸°ë¡\ní…Œì´ë¸”: change_history\nì €ì¥: ìš”ì•½ + ì¤‘ìš”ë„ë§Œ (ê°€ë²¼ì›€)",
        "height": 256,
        "width": 208
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1280,
        192
      ],
      "typeVersion": 1,
      "id": "eaaa4c42-31b6-4107-93d9-fb588954dc13",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "###  ì¤‘ìš”í•œ ë³€ê²½ì¸ì§€ ì²´í¬\nì¡°ê±´: is_important\nTRUE â†’ Slack ì•Œë¦¼\nFALSE â†’ ì¢…ë£Œ",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1488,
        192
      ],
      "typeVersion": 1,
      "id": "f14a5952-2081-455f-bf67-3653cd5a2dc5",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "### ì¤‘ìš” ë³€ê²½ì‚¬í•­ ì•Œë¦¼\në©”ì‹œì§€: \"ğŸš¨ ì¤‘ìš” ë³€ê²½: 50ê°œ í–‰ ì¶”ê°€ë¨\"",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1728,
        192
      ],
      "typeVersion": 1,
      "id": "a6317e68-c820-4797-9335-8a8c07f8364c",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "content": "# Triger",
        "height": 368,
        "width": 464,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -832,
        112
      ],
      "typeVersion": 1,
      "id": "87170f10-6cab-47a3-9247-561f0ab990ce",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "# Target",
        "height": 368,
        "width": 960,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1040,
        112
      ],
      "typeVersion": 1,
      "id": "14d7a4b4-3ed0-4d2e-b594-308445f412db",
      "name": "Sticky Note25"
    },
    {
      "parameters": {
        "content": "# Task",
        "height": 368,
        "width": 1264,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -304,
        112
      ],
      "typeVersion": 1,
      "id": "234b0910-cc3f-43e5-9e9f-55cb92c1e39a",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "content": "### ì´ì „ ë²„ì „ ì¡°íšŒ\nì¿¼ë¦¬: SELECT * FROM sheet_versions ORDER BY id DESC LIMIT 1\nì¶œë ¥: ë§ˆì§€ë§‰ ì €ì¥ëœ ë²„ì „",
        "height": 256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -32,
        176
      ],
      "typeVersion": 1,
      "id": "798c6177-563b-42a9-9b42-ff67695151fc",
      "name": "Sticky Note27"
    }
  ],
  "pinData": {},
  "connections": {
    "Every 5 Minutes1": {
      "main": [
        [
          {
            "node": "Read Current Sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Current Sheet1": {
      "main": [
        [
          {
            "node": "Prepare Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Data1": {
      "main": [
        [
          {
            "node": "Get Last Version1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Last Version1": {
      "main": [
        [
          {
            "node": "OpenAI HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI HTTP Request1": {
      "main": [
        [
          {
            "node": "Parse AI Response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Response1": {
      "main": [
        [
          {
            "node": "IF Changes Detected1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Changes Detected1": {
      "main": [
        [
          {
            "node": "Save Version1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Version1": {
      "main": [
        [
          {
            "node": "Save Change History1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Change History1": {
      "main": [
        [
          {
            "node": "IF Important Change1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Important Change1": {
      "main": [
        [
          {
            "node": "Send Slack Notification1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "763f44f2-039c-46ee-8acc-a3dcdab3166b",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "hB0Uxc0NDbIpHHWX",
  "tags": []
}